<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button onclick="inserirUser()">Inserir Usuário no Banco</button>
    <button onclick="inserirProd()">Inserir Produtos no Banco</button>
  </body>

  <script>

    function gerarCPF() {
    // Gera os 9 primeiros dígitos aleatoriamente
    let cpf = Array.from({length: 9}, () => Math.floor(Math.random() * 10)).join('');

    // Calcula o primeiro dígito verificador
    let soma = 0;
    for (let i = 0; i < 9; i++) {
        soma += parseInt(cpf[i]) * (10 - i);
    }
    let resto = soma % 11;
    let digito1 = resto < 2 ? 0 : 11 - resto;
    cpf += digito1;

    // Calcula o segundo dígito verificador
    soma = 0;
    for (let i = 0; i < 10; i++) {
        soma += parseInt(cpf[i]) * (11 - i);
    }
    resto = soma % 11;
    let digito2 = resto < 2 ? 0 : 11 - resto;
    cpf += digito2;

    return cpf;
}

// Função para formatar o CPF com máscara
function formatarCPF(cpf) {
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
}

    async function inserirUser() {
      await fetch("https://randomuser.me/api/?results=1")
        .then((response) => response.json())
        .then((data) => {
            console.log(data)
            var name = data.results[0].name.first + " " + data.results[0].name.last
            var email = data.results[0].email
            var password = data.results[0].login.password
            var endereco = data.results[0].location.street.name
            var telefone = data.results[0].phone
            var cpf = formatarCPF(gerarCPF())           

            enviarUser(name, email, password, endereco, telefone, cpf)
        });
    }

    async function enviarUser(name,email,password,endereco,telefone,cpf){
            const user = {
                name: name,
                email: email,
                password: password,
                endereco: endereco,
                telefone: telefone,
                cpf: cpf
            };

            await fetch('http://localhost:3000/api/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert("Usuario inserido com sucesso")
            })
            .catch((error) => {
                console.error('Error:', error);
                alert("Erro ao inserir usuario")
            });
        }
        

    /*
        {
    "name":"guilherme felipe",
    "email":"guifelipe@outlook.com",
    "password":"123454656",
    "endereco":"prudente",
    "telefone":"18997690124",
    "cpf":"12201525382"
}
        */
  </script>
</html>
