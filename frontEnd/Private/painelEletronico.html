<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Administrativo - Usuários</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --font-family: "Segoe UI", sans-serif;
      }

      [data-font="inter"] {
        --font-family: "Inter", sans-serif;
      }

      [data-font="roboto"] {
        --font-family: "Roboto", sans-serif;
      }

      [data-font="opensans"] {
        --font-family: "Open Sans", sans-serif;
      }

      [data-font="montserrat"] {
        --font-family: "Montserrat", sans-serif;
      }

      /* Aplicando a fonte no body */
      body {
        font-family: var(--font-family);
        transition: font-family 0.3s ease;
      }

      .font-option.active {
    background-color: var(--primary-color) !important;
    color: white !important;
    border-color: var(--primary-color) !important;
}

      :root {
        --primary-color: #667eea;
        --secondary-color: #764ba2;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --dark-color: #343a40;
        --light-color: #f8f9fa;
        --bg-color: #f5f7fb;
        --text-color: #333;
        --card-bg: #ffffff;
        --sidebar-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --border-color: #dee2e6;
      }

      [data-theme="dark"] {
        --primary-color: #8fa1f0;
        --secondary-color: #9b6bd4;
        --bg-color: #1a1d23;
        --text-color: #e9ecef;
        --card-bg: #2d3035;
        --sidebar-bg: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        --border-color: #495057;
        --light-color: #495057;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        transition: all 0.3s ease;
      }

      .sidebar {
        background: var(--sidebar-bg);
        color: white;
        min-height: 100vh;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      }

      .sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 12px 20px;
        margin: 5px 0;
        border-radius: 8px;
        transition: all 0.3s;
      }

      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
      }

      .sidebar .nav-link i {
        margin-right: 10px;
        font-size: 1.2rem;
      }

      .main-content {
        padding: 20px;
      }

      .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
        transition: transform 0.3s;
        background-color: var(--card-bg);
        color: var(--text-color);
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .stat-card {
        text-align: center;
        padding: 20px;
      }

      .stat-card i {
        font-size: 2.5rem;
        margin-bottom: 15px;
        opacity: 0.8;
      }

      .stat-card .number {
        font-size: 2rem;
        font-weight: bold;
        margin: 10px 0;
      }

      .stat-card .label {
        color: #6c757d;
        font-size: 0.9rem;
      }

      .bg-primary-light {
        background-color: rgba(102, 126, 234, 0.1);
        color: var(--primary-color);
      }

      .bg-success-light {
        background-color: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
      }

      .bg-warning-light {
        background-color: rgba(255, 193, 7, 0.1);
        color: var(--warning-color);
      }

      .bg-info-light {
        background-color: rgba(23, 162, 184, 0.1);
        color: var(--info-color);
      }

      .table-container {
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      .table {
        color: var(--text-color);
        margin-bottom: 0;
      }

      .table th {
        border-bottom: 2px solid var(--border-color);
        font-weight: 600;
      }

      .table td {
        border-bottom: 1px solid var(--border-color);
        vertical-align: middle;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }

      .action-btn {
        padding: 5px 10px;
        margin: 0 2px;
        border-radius: 5px;
        border: none;
        transition: all 0.3s;
        cursor: pointer;
      }

      .btn-view {
        background-color: rgba(23, 162, 184, 0.1);
        color: var(--info-color);
      }

      .btn-edit {
        background-color: rgba(255, 193, 7, 0.1);
        color: var(--warning-color);
      }

      .btn-delete {
        background-color: rgba(220, 53, 69, 0.1);
        color: var(--danger-color);
      }

      .btn-view:hover,
      .btn-edit:hover,
      .btn-delete:hover {
        transform: scale(1.1);
      }

      .modal-content {
        background-color: var(--card-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .modal-header {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        color: white;
        border-bottom: 1px solid var(--border-color);
      }

      .modal-footer {
        border-top: 1px solid var(--border-color);
      }

      .search-box {
        position: relative;
      }

      .search-box i {
        position: absolute;
        left: 15px;
        top: 12px;
        color: #6c757d;
      }

      .search-box input {
        padding-left: 40px;
        background-color: var(--card-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .search-box input:focus {
        background-color: var(--card-bg);
        color: var(--text-color);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .page-title {
        color: var(--text-color);
        margin-bottom: 20px;
        font-weight: 600;
      }

      .badge-role {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .chart-container {
        height: 300px;
        position: relative;
      }

      .password-field {
        position: relative;
      }

      .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        z-index: 5;
      }

      .theme-switcher {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }

      .theme-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background: var(--primary-color);
        color: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .theme-btn:hover {
        transform: scale(1.1);
      }

      .form-control,
      .form-select {
        background-color: var(--card-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .form-control:focus,
      .form-select:focus {
        background-color: var(--card-bg);
        color: var(--text-color);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .pagination .page-link {
        background-color: var(--card-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .pagination .page-item.active .page-link {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .pagination .page-link:hover {
        background-color: var(--light-color);
        border-color: var(--border-color);
      }

      .dropdown-menu {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
      }

      .dropdown-item {
        color: var(--text-color);
      }

      .dropdown-item:hover {
        background-color: rgba(102, 126, 234, 0.1);
        color: var(--text-color);
      }

      .settings-panel {
        position: fixed;
        top: 50%;
        right: -300px;
        transform: translateY(-50%);
        width: 300px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 10px 0 0 10px;
        padding: 20px;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1050;
      }

      .settings-panel.open {
        right: 0;
      }

      .settings-toggle {
        position: absolute;
        left: -40px;
        top: 20px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 5px 0 0 5px;
        padding: 10px;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .color-option {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin: 5px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        display: inline-block;
      }

      .color-option.active {
        border-color: var(--text-color);
        transform: scale(1.1);
      }

      .color-option:hover {
        transform: scale(1.1);
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1060;
        min-width: 300px;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1070;
        display: none;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .export-options {
        display: none;
        position: absolute;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        z-index: 100;
      }

      .export-options.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
      <button class="settings-toggle" onclick="toggleSettings()">
        <i class="bi bi-palette"></i>
      </button>
      <h5 class="mb-4"><i class="bi bi-sliders"></i> Configurações</h5>

      <div class="mb-4">
        <label class="form-label fw-bold">Tema</label>
        <div class="d-flex gap-2">
          <button
            class="btn btn-outline-primary flex-fill"
            onclick="setTheme('light')"
          >
            <i class="bi bi-sun"></i> Claro
          </button>
          <button
            class="btn btn-outline-primary flex-fill"
            onclick="setTheme('dark')"
          >
            <i class="bi bi-moon"></i> Escuro
          </button>
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Cores Primárias</label>
        <div class="d-flex flex-wrap justify-content-center">
          <div
            class="color-option active"
            style="background-color: #667eea"
            onclick="setPrimaryColor('#667eea')"
            title="Azul"
          ></div>
          <div
            class="color-option"
            style="background-color: #e53e3e"
            onclick="setPrimaryColor('#e53e3e')"
            title="Vermelho"
          ></div>
          <div
            class="color-option"
            style="background-color: #38a169"
            onclick="setPrimaryColor('#38a169')"
            title="Verde"
          ></div>
          <div
            class="color-option"
            style="background-color: #d69e2e"
            onclick="setPrimaryColor('#d69e2e')"
            title="Amarelo"
          ></div>
          <div
            class="color-option"
            style="background-color: #3182ce"
            onclick="setPrimaryColor('#3182ce')"
            title="Azul Claro"
          ></div>
          <div
            class="color-option"
            style="background-color: #805ad5"
            onclick="setPrimaryColor('#805ad5')"
            title="Roxo"
          ></div>
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Fonte</label>
        <div class="d-flex gap-2">
          <button
            class="btn btn-outline-primary flex-fill"
            onclick="setFont('segoe')"
          >
            <i class="bi bi-sun"></i> Segoe UI
          </button>
          <button
            class="btn btn-outline-primary flex-fill"
            onclick="setFont('roboto')"
          >
            <i class="bi bi-sun"></i> Roboto
          </button>
          <button
            class="btn btn-outline-primary flex-fill"
            onclick="setFont('inter')"
          >
            <i class="bi bi-moon"></i> Inter
          </button>
          <button
            class="btn btn-outline-primary flex-fill"
            onclick="setFont('open')"
          >
            <i class="bi bi-sun"></i> Open Sans
          </button>
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Itens por Página</label>
        <select
          class="form-select"
          id="itemsPerPage"
          onchange="updateItemsPerPage()"
        >
          <option value="5">5 itens</option>
          <option value="10" selected>10 itens</option>
          <option value="20">20 itens</option>
          <option value="50">50 itens</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Ordenação</label>
        <select class="form-select" id="sortBy" onchange="applySorting()">
          <option value="name">Nome A-Z</option>
          <option value="name_desc">Nome Z-A</option>
          <option value="date">Data de Registro (Mais Recente)</option>
          <option value="date_old">Data de Registro (Mais Antigo)</option>
          <option value="role">Perfil</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label fw-bold">Exportar Dados</label>
        <div class="d-grid gap-2">
          <button
            class="btn btn-outline-success btn-sm"
            onclick="exportToCSV()"
          >
            <i class="bi bi-file-earmark-spreadsheet"></i> CSV
          </button>
          <button
            class="btn btn-outline-primary btn-sm"
            onclick="exportToJSON()"
          >
            <i class="bi bi-code-slash"></i> JSON
          </button>
          <button class="btn btn-outline-danger btn-sm" onclick="exportToPDF()">
            <i class="bi bi-file-pdf"></i> PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Notification Area -->
    <div class="notification" id="notificationArea"></div>

    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 sidebar p-0">
          <div class="d-flex flex-column p-3">
            <div class="text-center mb-4 mt-3">
              <div
                class="user-avatar mx-auto mb-3"
                style="width: 60px; height: 60px; font-size: 1.5rem"
              >
                <i class="bi bi-person-badge"></i>
              </div>
              <h5>Admin Panel</h5>
              <p class="text-muted small">Gerenciamento de Usuários</p>
            </div>

            <ul class="nav nav-pills flex-column mb-auto">
              <li class="nav-item">
                <a href="#" class="nav-link active">
                  <i class="bi bi-speedometer2"></i> Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="bi bi-people"></i> Usuários
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="bi bi-graph-up"></i> Estatísticas
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" onclick="toggleSettings()">
                  <i class="bi bi-palette"></i> Aparência
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="bi bi-gear"></i> Configurações
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" onclick="PainelProdutos()">
                  <i class="bi bi-box"></i> Painel de Produtos
                </a>
              </li>
            </ul>

            <div class="dropdown mt-auto border-top pt-3">
              <a
                href="#"
                class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
                id="dropdownUser"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <div class="user-avatar me-2">A</div>
                <div>
                  <strong>Administrador</strong>
                  <div class="small">Super Admin</div>
                </div>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-dark text-small shadow"
                aria-labelledby="dropdownUser"
              >
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="bi bi-person"></i> Perfil</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#" onclick="toggleSettings()"
                    ><i class="bi bi-palette"></i> Aparência</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="bi bi-box-arrow-right"></i> Sair</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10 main-content">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
              <h2 class="page-title mb-1">Dashboard de Usuários</h2>
              <p class="text-muted mb-0">
                Gerencie todos os usuários do sistema
              </p>
            </div>
            <div>
              <button
                class="btn btn-outline-secondary me-2"
                onclick="toggleSettings()"
                title="Configurações"
              >
                <i class="bi bi-sliders"></i>
              </button>
              <button
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#addUserModal"
              >
                <i class="bi bi-plus-circle"></i> Adicionar Usuário
              </button>
            </div>
          </div>

          <!-- Statistics Cards -->
          <div class="stats-grid">
            <div class="card stat-card bg-primary-light">
              <i class="bi bi-people"></i>
              <div class="number" id="totalUsers">0</div>
              <div class="label">Total de Usuários</div>
            </div>
            <div class="card stat-card bg-success-light">
              <i class="bi bi-person-check"></i>
              <div class="number" id="activeUsers">0</div>
              <div class="label">Usuários Ativos</div>
            </div>
            <div class="card stat-card bg-warning-light">
              <i class="bi bi-person-plus"></i>
              <div class="number" id="newUsers">0</div>
              <div class="label">Novos (7 dias)</div>
            </div>
            <div class="card stat-card bg-info-light">
              <i class="bi bi-graph-up-arrow"></i>
              <div class="number" id="growthRate">0%</div>
              <div class="label">Taxa de Crescimento</div>
            </div>
          </div>

          <!-- Search and Filters -->
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="search-box">
                <i class="bi bi-search"></i>
                <input
                  type="text"
                  class="form-control"
                  id="searchInput"
                  placeholder="Buscar usuários por nome, email ou CPF..."
                />
              </div>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="filterRole">
                <option value="">Todos os perfis</option>
                <option value="admin">Administrador</option>
                <option value="user">Usuário</option>
              </select>
            </div>
            <div class="col-md-3">
              <div class="d-flex gap-2">
                <button
                  class="btn btn-outline-secondary flex-fill"
                  id="clearFilters"
                >
                  <i class="bi bi-arrow-clockwise"></i> Limpar
                </button>
                <div class="dropdown">
                  <button
                    class="btn btn-outline-primary dropdown-toggle"
                    type="button"
                    data-bs-toggle="dropdown"
                  >
                    <i class="bi bi-download"></i> Exportar
                  </button>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="#" onclick="exportToCSV()"
                        ><i class="bi bi-file-earmark-spreadsheet"></i> CSV</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="#" onclick="exportToJSON()"
                        ><i class="bi bi-code-slash"></i> JSON</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="#" onclick="exportToPDF()"
                        ><i class="bi bi-file-pdf"></i> PDF</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Users Table -->
          <div class="table-container mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0">
                <i class="bi bi-list-ul"></i> Lista de Usuários
                <span class="badge bg-primary ms-2" id="usersCount">0</span>
              </h5>
              <div class="d-flex align-items-center">
                <span class="me-2 small text-muted">Ordenar por:</span>
                <select
                  class="form-select form-select-sm w-auto"
                  id="tableSort"
                  onchange="applySorting()"
                >
                  <option value="name">Nome A-Z</option>
                  <option value="name_desc">Nome Z-A</option>
                  <option value="date">Data ↑</option>
                  <option value="date_old">Data ↓</option>
                </select>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-hover" id="usersTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Usuário</th>
                    <th>Email</th>
                    <th>Telefone</th>
                    <th>CPF</th>
                    <th>Endereço</th>
                    <th>Perfil</th>
                    <th>Data de Registro</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <!-- Users will be loaded here dynamically -->
                </tbody>
              </table>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-3">
              <div class="text-muted small">
                Mostrando <span id="showingStart">0</span> -
                <span id="showingEnd">0</span> de
                <span id="totalCount">0</span> usuários
              </div>
              <nav aria-label="Page navigation">
                <ul
                  class="pagination justify-content-center mb-0"
                  id="pagination"
                >
                  <!-- Pagination will be generated here -->
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add User Modal -->
    <div
      class="modal fade"
      id="addUserModal"
      tabindex="-1"
      aria-labelledby="addUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addUserModalLabel">
              <i class="bi bi-person-plus"></i> Adicionar Novo Usuário
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addUserForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="name" class="form-label">Nome Completo *</label>
                    <input
                      type="text"
                      class="form-control"
                      id="name"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="email" class="form-label">Email *</label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3 password-field">
                    <label for="password" class="form-label">Senha *</label>
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      required
                      minlength="6"
                    />
                    <button
                      type="button"
                      class="toggle-password"
                      onclick="togglePassword('password')"
                    >
                      <i class="bi bi-eye"></i>
                    </button>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3 password-field">
                    <label for="confirmPassword" class="form-label"
                      >Confirmar Senha *</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="confirmPassword"
                      required
                      minlength="6"
                    />
                    <button
                      type="button"
                      class="toggle-password"
                      onclick="togglePassword('confirmPassword')"
                    >
                      <i class="bi bi-eye"></i>
                    </button>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="cpf" class="form-label">CPF *</label>
                    <input
                      type="text"
                      class="form-control"
                      id="cpf"
                      required
                      placeholder="000.000.000-00"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="telefone" class="form-label">Telefone</label>
                    <input
                      type="text"
                      class="form-control"
                      id="telefone"
                      placeholder="(00) 00000-0000"
                    />
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="endereco" class="form-label">Endereço *</label>
                <input
                  type="text"
                  class="form-control"
                  id="endereco"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="role" class="form-label">Perfil *</label>
                <select class="form-select" id="role" required>
                  <option value="user">Usuário</option>
                  <option value="admin">Administrador</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="bi bi-x-circle"></i> Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveUserBtn"
              onclick="saveUser()"
            >
              <i class="bi bi-check-circle"></i> Salvar Usuário
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div
      class="modal fade"
      id="editUserModal"
      tabindex="-1"
      aria-labelledby="editUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editUserModalLabel">
              <i class="bi bi-pencil-square"></i> Editar Usuário
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editUserForm">
              <input type="hidden" id="editUserId" />
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="editName" class="form-label"
                      >Nome Completo *</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="editName"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="editEmail" class="form-label">Email *</label>
                    <input
                      type="email"
                      class="form-control"
                      id="editEmail"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3 password-field">
                    <label for="editPassword" class="form-label"
                      >Nova Senha (deixe em branco para manter a atual)</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="editPassword"
                      minlength="6"
                    />
                    <button
                      type="button"
                      class="toggle-password"
                      onclick="togglePassword('editPassword')"
                    >
                      <i class="bi bi-eye"></i>
                    </button>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="editCpf" class="form-label">CPF *</label>
                    <input
                      type="text"
                      class="form-control"
                      id="editCpf"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="editTelefone" class="form-label"
                      >Telefone</label
                    >
                    <input type="text" class="form-control" id="editTelefone" />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="editEndereco" class="form-label"
                      >Endereço *</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="editEndereco"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="editRole" class="form-label">Perfil *</label>
                <select class="form-select" id="editRole" required>
                  <option value="user">Usuário</option>
                  <option value="admin">Administrador</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="bi bi-x-circle"></i> Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="updateUserBtn"
              onclick="updateUser()"
            >
              <i class="bi bi-check-circle"></i> Atualizar Usuário
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- View User Modal -->
    <div
      class="modal fade"
      id="viewUserModal"
      tabindex="-1"
      aria-labelledby="viewUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="viewUserModalLabel">
              <i class="bi bi-person"></i> Detalhes do Usuário
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-4">
              <div
                class="user-avatar mx-auto"
                style="width: 80px; height: 80px; font-size: 1.5rem"
                id="viewUserAvatar"
              >
                U
              </div>
              <h4 class="mt-2" id="viewUserName"></h4>
              <span
                class="badge badge-role bg-primary"
                id="viewUserRole"
              ></span>
            </div>

            <div class="row">
              <div class="col-md-6">
                <p><strong>Email:</strong> <span id="viewUserEmail"></span></p>
                <p>
                  <strong>Telefone:</strong> <span id="viewUserTelefone"></span>
                </p>
              </div>
              <div class="col-md-6">
                <p><strong>CPF:</strong> <span id="viewUserCpf"></span></p>
                <p>
                  <strong>Endereço:</strong> <span id="viewUserEndereco"></span>
                </p>
              </div>
            </div>

            <div class="mt-3">
              <p>
                <strong>Data de Registro:</strong>
                <span id="viewUserCreatedAt"></span>
              </p>
              <p>
                <strong>Última Atualização:</strong>
                <span id="viewUserUpdatedAt"></span>
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="bi bi-x-circle"></i> Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div
      class="modal fade"
      id="deleteUserModal"
      tabindex="-1"
      aria-labelledby="deleteUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteUserModalLabel">
              <i class="bi bi-exclamation-triangle"></i> Confirmar Exclusão
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <i class="bi bi-trash display-4 text-danger"></i>
            </div>
            <p>
              Tem certeza que deseja excluir o usuário
              <strong id="deleteUserName"></strong>?
            </p>
            <p class="text-danger">
              <small>Esta ação não pode ser desfeita.</small>
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="bi bi-x-circle"></i> Cancelar
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="confirmDeleteBtn"
              onclick="deleteUser()"
            >
              <i class="bi bi-trash"></i> Excluir
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap & Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // Configurações globais
      let users = [];
      let currentPage = 1;
      let usersPerPage = 10;
      let currentTheme = "light";
      let primaryColor = "#667eea";
      let currentSort = "name";

      // Inicialização
      document.addEventListener("DOMContentLoaded", function () {
        loadSettings();
        loadUsers();
        setupEventListeners();
      });

      function PainelProdutos() {
        window.location.href = "PainelProdutos.html";
      }

     // Carregar configurações salvas
function loadSettings() {
    const savedTheme = localStorage.getItem("theme") || "light";
    const savedColor = localStorage.getItem("primaryColor") || "#667eea";
    const savedItemsPerPage = localStorage.getItem("itemsPerPage") || "10";
    const savedSort = localStorage.getItem("sortBy") || "name";
    const savedFont = localStorage.getItem("selectedFont") || "segoe"; // Nova linha

    setTheme(savedTheme);
    setPrimaryColor(savedColor, false);
    setFont(savedFont); // Nova linha

    usersPerPage = parseInt(savedItemsPerPage);
    document.getElementById("itemsPerPage").value = savedItemsPerPage;

    currentSort = savedSort;
    document.getElementById("sortBy").value = savedSort;
    document.getElementById("tableSort").value = savedSort;
}

// Configurar fonte
function setFont(fontName) {
    // Remove a fonte anterior do documento
    document.documentElement.removeAttribute('data-font');
    
    // Aplica a nova fonte
    document.documentElement.setAttribute('data-font', fontName);
    
    // Salva no localStorage
    localStorage.setItem('selectedFont', fontName);
    
    // Atualiza o botão ativo
    updateActiveFontButton(fontName);
    
    // Mostra notificação
    const fontNames = {
        'segoe': 'Segoe UI',
        'inter': 'Inter',
        'roboto': 'Roboto',
        'opensans': 'Open Sans',
        'montserrat': 'Montserrat'
    };
    showNotification(`Fonte ${fontNames[fontName] || fontName} aplicada`, 'success');
}

// Função auxiliar para mostrar qual fonte está ativa
function updateActiveFontButton(activeFont) {
    document.querySelectorAll('.font-option').forEach(button => {
        button.classList.remove('active');
        if (button.getAttribute('data-font') === activeFont) {
            button.classList.add('active');
        }
    });
}

// Configurar tema
function setTheme(theme) {
    currentTheme = theme;
    document.body.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
    showNotification(
        `Tema ${theme === "dark" ? "escuro" : "claro"} ativado`,
        "success"
    );
}

      // Configurar cor primária
      function setPrimaryColor(color, showNotification = true) {
        primaryColor = color;
        document.documentElement.style.setProperty("--primary-color", color);

        // Atualizar gradientes
        const shades = generateColorShades(color);
        document.documentElement.style.setProperty(
          "--secondary-color",
          shades.dark
        );

        // Atualizar botões ativos
        document.querySelectorAll(".color-option").forEach((option) => {
          option.classList.remove("active");
        });
        event.target.classList.add("active");

        if (showNotification) {
          showNotification("Cor primária alterada", "success");
        }

        localStorage.setItem("primaryColor", color);
      }

      // Gerar tons de cor
      function generateColorShades(hex) {
        return {
          light: hex,
          dark: adjustColor(hex, -40),
        };
      }

      function adjustColor(hex, amount) {
        return (
          "#" +
          hex
            .replace(/^#/, "")
            .replace(/../g, (color) =>
              (
                "0" +
                Math.min(
                  255,
                  Math.max(0, parseInt(color, 16) + amount)
                ).toString(16)
              ).substr(-2)
            )
        );
      }

      // Alternar painel de configurações
      function toggleSettings() {
        const panel = document.getElementById("settingsPanel");
        panel.classList.toggle("open");
      }

      // Atualizar itens por página
      function updateItemsPerPage() {
        usersPerPage = parseInt(document.getElementById("itemsPerPage").value);
        localStorage.setItem("itemsPerPage", usersPerPage);
        currentPage = 1;
        renderUsers();
        showNotification(`Mostrando ${usersPerPage} itens por página`, "info");
      }

      // Aplicar ordenação
      function applySorting() {
        currentSort = document.getElementById("tableSort").value;
        localStorage.setItem("sortBy", currentSort);
        renderUsers();
        showNotification(`Ordenação aplicada`, "info");
      }

      // Mostrar notificação
      function showNotification(message, type = "info") {
        const notificationArea = document.getElementById("notificationArea");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type} alert-dismissible fade show`;
        alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
        notificationArea.appendChild(alert);

        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
        }, 4000);
      }

      // Mostrar/ocultar loading
      function showLoading(show) {
        document.getElementById("loadingOverlay").style.display = show
          ? "flex"
          : "none";
          setTimeout(() => {
            document.getElementById("loadingOverlay").style.opacity = show ? 1 : 0;
          })
      }

      // Setup event listeners
      function setupEventListeners() {
        document
          .getElementById("searchInput")
          .addEventListener("input", filterUsers);
        document
          .getElementById("filterRole")
          .addEventListener("change", filterUsers);
        document
          .getElementById("clearFilters")
          .addEventListener("click", clearAllFilters);

        // Máscaras
        document.getElementById("cpf").addEventListener("input", function (e) {
          formatCPF(e.target);
        });
        document
          .getElementById("editCpf")
          .addEventListener("input", function (e) {
            formatCPF(e.target);
          });
        document
          .getElementById("telefone")
          .addEventListener("input", function (e) {
            formatPhone(e.target);
          });
        document
          .getElementById("editTelefone")
          .addEventListener("input", function (e) {
            formatPhone(e.target);
          });

        // Reset form quando modal fechar
        const addUserModal = document.getElementById("addUserModal");
        addUserModal.addEventListener("hidden.bs.modal", function () {
          document.getElementById("addUserForm").reset();
        });
      }

      // Carregar usuários da API
      async function loadUsers() {
        showLoading(true);
        try {
          const response = await fetch(
            "http://localhost:3000/api/users/allusers"
          );
          if (!response.ok) throw new Error("Erro ao carregar usuários");

          const result = await response.json();
          users = result.users || result;
          console.log("Usuários carregados:", users);

          renderUsers();
          updateStatistics();
          showNotification("Usuários carregados com sucesso", "success");
        } catch (error) {
          console.error("Error loading users:", error);
          showNotification("Erro ao carregar usuários", "danger");
          // Dados de exemplo para demonstração
          users = getSampleUsers();
          renderUsers();
          updateStatistics();
        } finally {
          showLoading(false);
        }
      }

      // Renderizar usuários na tabela
      function renderUsers() {
        const filteredUsers = getFilteredUsers();
        const sortedUsers = sortUsers(filteredUsers);
        const startIndex = (currentPage - 1) * usersPerPage;
        const endIndex = startIndex + usersPerPage;
        const usersToShow = sortedUsers.slice(startIndex, endIndex);

        const usersTableBody = document.getElementById("usersTableBody");
        usersTableBody.innerHTML = "";

        if (usersToShow.length === 0) {
          usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center py-4">
                            <i class="bi bi-people display-4 text-muted"></i>
                            <p class="mt-2 text-muted">Nenhum usuário encontrado</p>
                            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                <i class="bi bi-plus-circle"></i> Adicionar Primeiro Usuário
                            </button>
                        </td>
                    </tr>
                `;
        } else {
          usersToShow.forEach((user) => {
            const row = document.createElement("tr");
            const firstLetter = user.name
              ? user.name.charAt(0).toUpperCase()
              : "U";

            row.innerHTML = `
                        <td><span class="badge bg-secondary">#${
                          user.id
                        }</span></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="user-avatar me-2">${firstLetter}</div>
                                <div>
                                    <div class="fw-semibold">${user.name}</div>
                                    <small class="text-muted">ID: ${
                                      user.id
                                    }</small>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>${
                          user.telefone ||
                          '<span class="text-muted">Não informado</span>'
                        }</td>
                        <td><code>${user.cpf}</code></td>
                        <td>${user.endereco}</td>
                        <td>
                            <span class="badge-role ${
                              user.role === "admin" ? "bg-danger" : "bg-primary"
                            }">
                                ${
                                  user.role === "admin"
                                    ? '<i class="bi bi-shield-check"></i> Admin'
                                    : '<i class="bi bi-person"></i> Usuário'
                                }
                            </span>
                        </td>
                        <td>
                            <small>${formatDate(user.createdAt)}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="action-btn btn-view" onclick="viewUser(${
                                  user.id
                                })" title="Visualizar">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="action-btn btn-edit" onclick="editUser(${
                                  user.id
                                })" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="confirmDelete(${
                                  user.id
                                })" title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
            usersTableBody.appendChild(row);
          });
        }

        updatePagination(filteredUsers.length);
        updateCounters(filteredUsers.length, startIndex, endIndex);
      }

      // Ordenar usuários
      function sortUsers(usersList) {
        const sorted = [...usersList];
        switch (currentSort) {
          case "name":
            return sorted.sort((a, b) => a.name.localeCompare(b.name));
          case "name_desc":
            return sorted.sort((a, b) => b.name.localeCompare(a.name));
          case "date":
            return sorted.sort(
              (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
            );
          case "date_old":
            return sorted.sort(
              (a, b) => new Date(a.createdAt) - new Date(b.createdAt)
            );
          case "role":
            return sorted.sort((a, b) => a.role.localeCompare(b.role));
          default:
            return sorted;
        }
      }

      // Atualizar contadores
      function updateCounters(total, start, end) {
        document.getElementById("usersCount").textContent = total;
        document.getElementById("showingStart").textContent = start + 1;
        document.getElementById("showingEnd").textContent = Math.min(
          end,
          total
        );
        document.getElementById("totalCount").textContent = total;
      }

      // Atualizar paginação
      function updatePagination(totalUsers) {
        const totalPages = Math.ceil(totalUsers / usersPerPage);
        const pagination = document.getElementById("pagination");

        pagination.innerHTML = "";

        if (totalPages <= 1) return;

        // Botão anterior
        const prevLi = createPaginationItem(
          "Anterior",
          currentPage - 1,
          currentPage === 1,
          "bi-chevron-left"
        );
        pagination.appendChild(prevLi);

        // Números das páginas
        for (let i = 1; i <= totalPages; i++) {
          const li = createPaginationItem(i, i, i === currentPage);
          pagination.appendChild(li);
        }

        // Botão próximo
        const nextLi = createPaginationItem(
          "Próxima",
          currentPage + 1,
          currentPage === totalPages,
          "bi-chevron-right"
        );
        pagination.appendChild(nextLi);
      }

      function createPaginationItem(text, page, disabled, icon = null) {
        const li = document.createElement("li");
        li.className = `page-item ${disabled ? "disabled" : ""} ${
          text === currentPage ? "active" : ""
        }`;

        const link = document.createElement("a");
        link.className = "page-link";
        link.href = "#";
        link.innerHTML = icon ? `<i class="bi ${icon}"></i>` : text;

        if (!disabled && text !== currentPage) {
          link.onclick = (e) => {
            e.preventDefault();
            changePage(page);
          };
        }

        li.appendChild(link);
        return li;
      }

      // Mudar página
      function changePage(page) {
        const filteredUsers = getFilteredUsers();
        const totalPages = Math.ceil(filteredUsers.length / usersPerPage);

        if (page < 1 || page > totalPages) return;

        currentPage = page;
        renderUsers();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // Filtrar usuários
      function getFilteredUsers() {
        const searchTerm = searchInput.value.toLowerCase();
        const roleFilter = filterRole.value;

        return users.filter((user) => {
          const matchesSearch =
            (user.name && user.name.toLowerCase().includes(searchTerm)) ||
            (user.email && user.email.toLowerCase().includes(searchTerm)) ||
            (user.cpf && user.cpf.includes(searchTerm));

          const matchesRole = !roleFilter || user.role === roleFilter;

          return matchesSearch && matchesRole;
        });
      }

      // Aplicar filtros
      function filterUsers() {
        currentPage = 1;
        renderUsers();
      }

      // Limpar todos os filtros
      function clearAllFilters() {
        searchInput.value = "";
        filterRole.value = "";
        currentPage = 1;
        renderUsers();
        showNotification("Filtros limpos", "info");
      }

      // Atualizar estatísticas
      function updateStatistics() {
        document.getElementById("totalUsers").textContent = users.length;
        document.getElementById("activeUsers").textContent = users.length;
        document.getElementById("newUsers").textContent = getNewUsersCount();
        document.getElementById("growthRate").textContent =
          calculateGrowthRate();
      }

      // Contar novos usuários (últimos 7 dias)
      function getNewUsersCount() {
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

        return users.filter((user) => {
          if (!user.createdAt) return false;
          return new Date(user.createdAt) > oneWeekAgo;
        }).length;
      }

      // Calcular taxa de crescimento
      function calculateGrowthRate() {
        if (users.length <= 1) return "0%";
        const lastWeekCount = Math.floor(users.length * 0.8);
        const growth = ((users.length - lastWeekCount) / lastWeekCount) * 100;
        return growth > 0 ? `+${growth.toFixed(1)}%` : `${growth.toFixed(1)}%`;
      }

      // Visualizar usuário
      function viewUser(userId) {
        const user = users.find((u) => u.id === userId);
        if (!user) {
          showNotification("Usuário não encontrado", "warning");
          return;
        }

        const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : "U";
        document.getElementById("viewUserAvatar").textContent = firstLetter;
        document.getElementById("viewUserName").textContent = user.name;
        document.getElementById("viewUserEmail").textContent = user.email;
        document.getElementById("viewUserTelefone").textContent =
          user.telefone || "Não informado";
        document.getElementById("viewUserCpf").textContent = user.cpf;
        document.getElementById("viewUserEndereco").textContent = user.endereco;
        document.getElementById("viewUserRole").textContent =
          user.role === "admin" ? "Administrador" : "Usuário";
        document.getElementById("viewUserCreatedAt").textContent = formatDate(
          user.createdAt
        );
        document.getElementById("viewUserUpdatedAt").textContent = formatDate(
          user.updatedAt
        );

        const modal = new bootstrap.Modal(
          document.getElementById("viewUserModal")
        );
        modal.show();
      }

      // Editar usuário
      function editUser(userId) {
        const user = users.find((u) => u.id === userId);
        if (!user) {
          showNotification("Usuário não encontrado", "warning");
          return;
        }

        document.getElementById("editUserId").value = user.id;
        document.getElementById("editName").value = user.name;
        document.getElementById("editEmail").value = user.email;
        document.getElementById("editCpf").value = user.cpf;
        document.getElementById("editTelefone").value = user.telefone || "";
        document.getElementById("editEndereco").value = user.endereco;
        document.getElementById("editRole").value = user.role;
        document.getElementById("editPassword").value = "";

        const modal = new bootstrap.Modal(
          document.getElementById("editUserModal")
        );
        modal.show();
      }

      // Atualizar usuário
      async function updateUser() {
        const userId = parseInt(document.getElementById("editUserId").value);
        const modalElement = document.getElementById("editUserModal");
        const modal = bootstrap.Modal.getInstance(modalElement);

        const updateData = {
          id: userId,
          name: document.getElementById("editName").value,
          email: document.getElementById("editEmail").value,
          cpf: document.getElementById("editCpf").value,
          telefone: document.getElementById("editTelefone").value,
          endereco: document.getElementById("editEndereco").value,
          role: document.getElementById("editRole").value,
        };

        // Add password only if provided
        const newPassword = document.getElementById("editPassword").value;
        if (newPassword) {
          if (newPassword.length < 6) {
            showNotification(
              "A senha deve ter pelo menos 6 caracteres",
              "warning"
            );
            return;
          }
          updateData.password = newPassword;
        }

        showLoading(true);
        try {
          const response = await fetch(
            `http://localhost:3000/api/users/update`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(updateData),
            }
          );

          const result = await response.json();

          if (response.ok) {
            // Update local data
            const updatedUserIndex = users.findIndex((u) => u.id === userId);
            if (updatedUserIndex !== -1) {
              users[updatedUserIndex] = {
                ...users[updatedUserIndex],
                ...updateData,
              };
            }

            renderUsers();
            modal.hide();
            showNotification("Usuário atualizado com sucesso!", "success");
          } else {
            throw new Error(result.message || "Erro ao atualizar usuário");
          }
        } catch (error) {
          console.error("Error updating user:", error);
          showNotification(
            "Erro ao atualizar usuário: " + error.message,
            "danger"
          );
        } finally {
          showLoading(false);
        }
      }

      // Confirmar exclusão
      function confirmDelete(userId) {
        const user = users.find((u) => u.id === userId);
        if (!user) {
          showNotification("Usuário não encontrado", "warning");
          return;
        }

        document.getElementById("deleteUserName").textContent = user.name;
        document
          .getElementById("confirmDeleteBtn")
          .setAttribute("data-user-id", userId);

        const modal = new bootstrap.Modal(
          document.getElementById("deleteUserModal")
        );
        modal.show();
      }

      // Excluir usuário
      async function deleteUser() {
        const userId = parseInt(
          document
            .getElementById("confirmDeleteBtn")
            .getAttribute("data-user-id")
        );
        const modalElement = document.getElementById("deleteUserModal");
        const modal = bootstrap.Modal.getInstance(modalElement);

        showLoading(true);
        try {
          const response = await fetch(
            `http://localhost:3000/api/users/delete`,
            {
              method: "DELETE",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ id: userId }),
            }
          );

          const result = await response.json();

          if (response.ok) {
            // Remove from local data
            users = users.filter((u) => u.id !== userId);
            loadUsers()
            renderUsers();
            updateStatistics();
            modal.hide();
            showNotification("Usuário excluído com sucesso!", "success");
          } else {
            throw new Error(result.message || "Erro ao excluir usuário");
          }
        } catch (error) {
          console.error("Error deleting user:", error);
          showNotification(
            "Erro ao excluir usuário: " + error.message,
            "danger"
          );
        } finally {
          showLoading(false);
        }
      }

      // Salvar novo usuário
      async function saveUser() {
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const cpf = document.getElementById("cpf").value;
        const telefone = document.getElementById("telefone").value;
        const endereco = document.getElementById("endereco").value;
        const role = document.getElementById("role").value;

        const modalElement = document.getElementById("addUserModal");
        const modal = bootstrap.Modal.getInstance(modalElement);

        // Validações locais
        if (password !== confirmPassword) {
          showNotification("As senhas não coincidem!", "warning");
          return;
        }

        if (password.length < 6) {
          showNotification(
            "A senha deve ter pelo menos 6 caracteres!",
            "warning"
          );
          return;
        }

        const userData = {
          name,
          email,
          password,
          cpf: cpf.replace(/\D/g, ""),
          telefone,
          endereco,
          role,
        };

        showLoading(true);
        try {
          const response = await fetch(
            "http://localhost:3000/api/users/register",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(userData),
            }
          );

          if (response.ok) {
            const newUser = await response.json();

            // Add to local data
            users.push(newUser.user || newUser);

            renderUsers();
            updateStatistics();
            document.getElementById("addUserForm").reset();
            modal.hide();
            showNotification("Usuário cadastrado com sucesso!", "success");
          } else {
            const error = await response.json();
            throw new Error(error.message || "Erro ao cadastrar usuário");
          }
        } catch (error) {
          console.error("Error saving user:", error);
          showNotification(
            "Erro ao cadastrar usuário: " + error.message,
            "danger"
          );
        } finally {
          showLoading(false);
        }
      }

      // Exportar dados
      function exportToCSV() {
        const filteredUsers = getFilteredUsers();
        const headers = [
          "ID",
          "Nome",
          "Email",
          "Telefone",
          "CPF",
          "Endereço",
          "Perfil",
          "Data de Registro",
        ];
        const csvContent = [
          headers.join(","),
          ...filteredUsers.map((user) =>
            [
              user.id,
              `"${user.name}"`,
              `"${user.email}"`,
              `"${user.telefone || ""}"`,
              `"${user.cpf}"`,
              `"${user.endereco}"`,
              user.role,
              formatDate(user.createdAt),
            ].join(",")
          ),
        ].join("\n");

        downloadFile(csvContent, "usuarios.csv", "text/csv");
        showNotification("Dados exportados para CSV", "success");
      }

      function exportToJSON() {
        const filteredUsers = getFilteredUsers();
        const jsonContent = JSON.stringify(filteredUsers, null, 2);
        downloadFile(jsonContent, "usuarios.json", "application/json");
        showNotification("Dados exportados para JSON", "success");
      }

      function exportToPDF() {
        // Simulação de exportação para PDF
        showNotification("Exportação para PDF em desenvolvimento", "info");
      }

      function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      // Funções utilitárias
      function formatDate(dateString) {
        if (!dateString) return "N/A";
        const date = new Date(dateString);
        return (
          date.toLocaleDateString("pt-BR") +
          " " +
          date.toLocaleTimeString("pt-BR")
        );
      }

      function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = field.parentNode.querySelector("i");
        if (field.type === "password") {
          field.type = "text";
          icon.classList.remove("bi-eye");
          icon.classList.add("bi-eye-slash");
        } else {
          field.type = "password";
          icon.classList.remove("bi-eye-slash");
          icon.classList.add("bi-eye");
        }
      }

      function formatCPF(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 11) value = value.substring(0, 11);

        if (value.length > 9) {
          value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
        } else if (value.length > 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
        } else if (value.length > 3) {
          value = value.replace(/(\d{3})(\d{1,3})/, "$1.$2");
        }
        input.value = value;
      }

      function formatPhone(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 11) value = value.substring(0, 11);

        if (value.length > 10) {
          value = value.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
        } else if (value.length > 6) {
          value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, "($1) $2-$3");
        } else if (value.length > 2) {
          value = value.replace(/(\d{2})(\d{0,5})/, "($1) $2");
        } else if (value.length > 0) {
          value = value.replace(/(\d{0,2})/, "($1");
        }
        input.value = value;
      }

      // Dados de exemplo para demonstração
      function getSampleUsers() {
        return [
          {
            id: 1,
            name: "João Silva",
            email: "joao.silva@email.com",
            telefone: "(11) 99999-9999",
            cpf: "123.456.789-00",
            endereco: "Rua das Flores, 123 - São Paulo, SP",
            role: "admin",
            createdAt: "2024-01-15T10:30:00Z",
            updatedAt: "2024-01-20T14:25:00Z",
          },
          {
            id: 2,
            name: "Maria Santos",
            email: "maria.santos@email.com",
            telefone: "(11) 88888-8888",
            cpf: "987.654.321-00",
            endereco: "Av. Paulista, 1000 - São Paulo, SP",
            role: "user",
            createdAt: "2024-01-18T09:15:00Z",
            updatedAt: "2024-01-18T09:15:00Z",
          },
          {
            id: 3,
            name: "Pedro Oliveira",
            email: "pedro.oliveira@email.com",
            telefone: "(11) 77777-7777",
            cpf: "456.789.123-00",
            endereco: "Rua Augusta, 500 - São Paulo, SP",
            role: "user",
            createdAt: "2024-01-20T16:45:00Z",
            updatedAt: "2024-01-20T16:45:00Z",
          },
        ];
      }
      document.addEventListener("DOMContentLoaded", function () {
          loadUsers()
      })
    </script>
  </body>
</html>
